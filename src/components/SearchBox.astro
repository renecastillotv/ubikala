---
import { getLangFromUrl, useTranslations, localizedUrl } from '../i18n';

interface Props {
  variant?: 'hero' | 'inline' | 'compact';
  locations?: Array<{ name: string; slug: string; count: number }>;
}

const { variant = 'hero', locations = [] } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const containerClass = {
  hero: 'search-box',
  inline: 'bg-white rounded-lg shadow-md p-4',
  compact: 'bg-white rounded-lg shadow-sm p-3'
}[variant];
---

{variant === 'compact' ? (
  <form
    action={localizedUrl('/buscar', lang)}
    method="GET"
    class={containerClass}
  >
    <div class="flex flex-col sm:flex-row gap-3">
      <select name="transactionType" class="select py-2 text-sm flex-1">
        <option value="all">{t.transactionTypes.all}</option>
        <option value="sale">{t.transactionTypes.sale}</option>
        <option value="rent">{t.transactionTypes.rent}</option>
      </select>
      <select name="propertyType" class="select py-2 text-sm flex-1">
        <option value="all">{t.propertyTypes.all}</option>
        <option value="house">{t.propertyTypes.house}</option>
        <option value="apartment">{t.propertyTypes.apartment}</option>
        <option value="villa">{t.propertyTypes.villa}</option>
        <option value="land">{t.propertyTypes.land}</option>
        <option value="commercial">{t.propertyTypes.commercial}</option>
      </select>
      {locations.length > 0 ? (
        <select name="location" class="select py-2 text-sm flex-1">
          <option value="">{t.filters.location}</option>
          {locations.map(loc => (
            <option value={loc.name}>{loc.name}</option>
          ))}
        </select>
      ) : (
        <select name="location" class="select py-2 text-sm flex-1">
          <option value="">{t.filters.location}</option>
        </select>
      )}
      <button type="submit" class="btn-primary py-2 px-4 text-sm whitespace-nowrap">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        {t.common.search}
      </button>
    </div>
  </form>
) : (
<form
  action={localizedUrl('/buscar', lang)}
  method="GET"
  class={containerClass}
>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Transaction Type -->
    <div>
      <label for="transaction" class="block text-sm font-medium text-gray-700 mb-2">
        {t.filters.transactionType}
      </label>
      <select id="transaction" name="transactionType" class="select">
        <option value="all">{t.transactionTypes.all}</option>
        <option value="sale">{t.transactionTypes.sale}</option>
        <option value="rent">{t.transactionTypes.rent}</option>
      </select>
    </div>

    <!-- Property Type -->
    <div>
      <label for="type" class="block text-sm font-medium text-gray-700 mb-2">
        {t.filters.propertyType}
      </label>
      <select id="type" name="propertyType" class="select">
        <option value="all">{t.propertyTypes.all}</option>
        <option value="house">{t.propertyTypes.house}</option>
        <option value="apartment">{t.propertyTypes.apartment}</option>
        <option value="villa">{t.propertyTypes.villa}</option>
        <option value="penthouse">{t.propertyTypes.penthouse}</option>
        <option value="land">{t.propertyTypes.land}</option>
        <option value="commercial">{t.propertyTypes.commercial}</option>
        <option value="office">{t.propertyTypes.office}</option>
      </select>
    </div>

    <!-- Location -->
    <div>
      <label for="location" class="block text-sm font-medium text-gray-700 mb-2">
        {t.filters.location}
      </label>
      {locations.length > 0 ? (
        <select id="location" name="location" class="select">
          <option value="">{t.filters.allLocations}</option>
          {locations.map(loc => (
            <option value={loc.name}>{loc.name}</option>
          ))}
        </select>
      ) : (
        <select id="location" name="location" class="select">
          <option value="">{t.filters.allLocations}</option>
        </select>
      )}
    </div>

    <!-- Price Range -->
    <div>
      <label for="price" class="block text-sm font-medium text-gray-700 mb-2">
        {t.filters.priceRange}
      </label>
      <select id="price" name="priceRange" class="select">
        <option value="">{t.filters.anyPrice}</option>
        <option value="0-100000">$0 - $100,000</option>
        <option value="100000-200000">$100,000 - $200,000</option>
        <option value="200000-300000">$200,000 - $300,000</option>
        <option value="300000-500000">$300,000 - $500,000</option>
        <option value="500000-1000000">$500,000 - $1,000,000</option>
        <option value="1000000+">$1,000,000+</option>
      </select>
    </div>
  </div>

  <!-- Additional Filters (Collapsible on mobile) -->
  <div class="mt-4 pt-4 border-t border-gray-200">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <!-- Bedrooms -->
      <div>
        <label for="bedrooms" class="block text-sm font-medium text-gray-700 mb-2">
          {t.filters.bedrooms}
        </label>
        <select id="bedrooms" name="bedrooms" class="select">
          <option value="">{t.filters.any}</option>
          <option value="1">1+</option>
          <option value="2">2+</option>
          <option value="3">3+</option>
          <option value="4">4+</option>
          <option value="5">5+</option>
        </select>
      </div>

      <!-- Bathrooms -->
      <div>
        <label for="bathrooms" class="block text-sm font-medium text-gray-700 mb-2">
          {t.filters.bathrooms}
        </label>
        <select id="bathrooms" name="bathrooms" class="select">
          <option value="">{t.filters.any}</option>
          <option value="1">1+</option>
          <option value="2">2+</option>
          <option value="3">3+</option>
          <option value="4">4+</option>
        </select>
      </div>

      <!-- Min Area -->
      <div>
        <label for="minArea" class="block text-sm font-medium text-gray-700 mb-2">
          {t.filters.minArea}
        </label>
        <input
          type="number"
          id="minArea"
          name="minArea"
          placeholder="0 m²"
          class="input"
        />
      </div>

      <!-- Max Area -->
      <div>
        <label for="maxArea" class="block text-sm font-medium text-gray-700 mb-2">
          {t.filters.maxArea}
        </label>
        <input
          type="number"
          id="maxArea"
          name="maxArea"
          placeholder="∞ m²"
          class="input"
        />
      </div>
    </div>
  </div>

  <!-- Search Button -->
  <div class="mt-6 flex flex-col sm:flex-row gap-3">
    <button type="submit" class="btn-primary flex-1 justify-center">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      {t.hero.cta}
    </button>
    <button type="reset" class="btn-outline">
      {t.filters.clear}
    </button>
  </div>
</form>
)}
