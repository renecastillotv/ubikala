---
import Layout from '../../../layouts/Layout.astro';
import Pagination from '../../../components/Pagination.astro';
import { useTranslations, getAlternateUrls, localizedUrl } from '../../../i18n';
import { getLocationsWithStats } from '../../../lib/meilisearch';

// SSR for dynamic data
export const prerender = false;

const t = useTranslations('en');
const alternateUrls = getAlternateUrls('/en/properties');

// Get all locations with counts
let locations: Array<{ slug: string; name: string; province: string; propertyCount: number; sampleImage: string | null }> = [];
try {
  locations = await getLocationsWithStats();
} catch (error) {
  console.error('Error fetching locations:', error);
}

// Placeholder image
const defaultImage = 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800';

const pageTitle = 'Properties by Location | Ub√≠kala.com';
const pageDescription = 'Explore properties for sale and rent in the main cities and areas of the Dominican Republic. Punta Cana, Santo Domingo, Santiago and more.';
---

<Layout
  title={pageTitle}
  description={pageDescription}
  keywords="dominican republic properties, real estate by location, houses santo domingo, apartments punta cana, properties santiago"
  alternateLanguages={alternateUrls}
>
  <!-- Breadcrumb -->
  <div class="bg-gray-100 py-4">
    <div class="container-custom">
      <nav class="flex text-sm text-gray-600">
        <a href="/en" class="hover:text-primary-600">{t.nav.home}</a>
        <span class="mx-2">/</span>
        <span class="text-gray-900 font-medium">Properties by Location</span>
      </nav>
    </div>
  </div>

  <!-- Hero -->
  <section class="bg-gradient-to-r from-primary-600 to-primary-700 py-12">
    <div class="container-custom">
      <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">
        Properties by Location
      </h1>
      <p class="text-primary-100 text-lg max-w-3xl">
        Explore the main cities and areas of the Dominican Republic where we have properties available for you.
      </p>
    </div>
  </section>

  <!-- Locations Grid -->
  <section class="section">
    <div class="container-custom">
      <div class="flex items-center justify-between mb-8">
        <p class="text-gray-600">
          <span class="font-semibold text-gray-900">{locations.length}</span> locations available
        </p>
      </div>

      {locations.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {locations.map((location) => (
            <a
              href={`/en/properties/${location.slug}`}
              class="group relative overflow-hidden rounded-2xl h-[250px]"
            >
              <img
                src={location.sampleImage || defaultImage}
                alt={`Properties in ${location.name}`}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>
              <div class="absolute bottom-0 left-0 right-0 p-6">
                <h3 class="text-white font-bold text-xl mb-1">
                  {location.name}
                </h3>
                <p class="text-gray-200 text-sm mb-3">
                  {location.province}
                </p>
                <span class="inline-flex items-center gap-2 text-white text-sm bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                  </svg>
                  {location.propertyCount} {location.propertyCount === 1 ? 'property' : 'properties'}
                </span>
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="card p-12 text-center">
          <p class="text-gray-600">No locations available.</p>
        </div>
      )}
    </div>
  </section>

  <!-- SEO Content -->
  <section class="py-12 bg-gray-50">
    <div class="container-custom">
      <div class="prose prose-lg max-w-4xl mx-auto">
        <h2>Find Properties Across the Country</h2>
        <p>
          The Dominican Republic offers a wide variety of locations for real estate investment.
          From the paradise beaches of Punta Cana to the vibrant capital Santo Domingo,
          each area has unique characteristics that suit different lifestyles and investment goals.
        </p>

        <h3>Most Popular Destinations</h3>
        <ul>
          <li><strong>Punta Cana:</strong> The #1 Caribbean tourist destination with excellent return on investment.</li>
          <li><strong>Santo Domingo:</strong> The capital with options for every budget.</li>
          <li><strong>Santiago:</strong> The second largest city with affordable prices.</li>
          <li><strong>Las Terrenas:</strong> Bohemian paradise with beachfront properties.</li>
          <li><strong>Puerto Plata:</strong> North coast with spectacular beaches and golf.</li>
        </ul>
      </div>
    </div>
  </section>
</Layout>
