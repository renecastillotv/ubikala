---
import Layout from '../../layouts/Layout.astro';
import PropertyCard from '../../components/PropertyCard.astro';
import SearchBox from '../../components/SearchBox.astro';
import { useTranslations, getAlternateUrls } from '../../i18n';
import { properties } from '../../data/properties';

const t = useTranslations('en');
const alternateUrls = getAlternateUrls('/en/search');

// Get query params
const query = Astro.url.searchParams.get('q') || '';
const type = Astro.url.searchParams.get('type') || '';
const transaction = Astro.url.searchParams.get('transaction') || '';
const location = Astro.url.searchParams.get('location') || '';
const minPrice = Astro.url.searchParams.get('minPrice') || '';
const maxPrice = Astro.url.searchParams.get('maxPrice') || '';

// Filter properties
let filteredProperties = [...properties];

if (query) {
  const q = query.toLowerCase();
  filteredProperties = filteredProperties.filter(p =>
    p.title.toLowerCase().includes(q) ||
    p.location.city.toLowerCase().includes(q) ||
    p.location.sector.toLowerCase().includes(q) ||
    p.description.toLowerCase().includes(q)
  );
}

if (type) {
  filteredProperties = filteredProperties.filter(p => p.type === type);
}

if (transaction) {
  filteredProperties = filteredProperties.filter(p => p.transaction === transaction);
}

if (location) {
  filteredProperties = filteredProperties.filter(p =>
    p.location.city.toLowerCase().includes(location.toLowerCase()) ||
    p.location.sector.toLowerCase().includes(location.toLowerCase())
  );
}

if (minPrice) {
  filteredProperties = filteredProperties.filter(p => p.price >= parseInt(minPrice));
}

if (maxPrice) {
  filteredProperties = filteredProperties.filter(p => p.price <= parseInt(maxPrice));
}
---

<Layout
  title={`Search Results${query ? ` for "${query}"` : ''} | PropiedadEnRD.com`}
  description="Search properties in the Dominican Republic. Houses, apartments, villas and land for sale and rent."
  keywords="search properties dr, find real estate dominican republic"
  alternateLanguages={alternateUrls}
>
  <!-- Search -->
  <section class="py-8 bg-white shadow-sm sticky top-16 z-40">
    <div class="container-custom">
      <SearchBox variant="inline" />
    </div>
  </section>

  <!-- Results -->
  <section class="section">
    <div class="container-custom">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">
            {query ? `Results for "${query}"` : 'All Properties'}
          </h1>
          <p class="text-gray-600 mt-1">
            <span class="font-semibold text-gray-900">{filteredProperties.length}</span> {t.filters.results}
          </p>
        </div>
        <select class="select py-2 text-sm w-auto">
          <option value="recent">Most Recent</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="area">Largest Area</option>
        </select>
      </div>

      {filteredProperties.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {filteredProperties.map((property) => (
            <PropertyCard property={property} />
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
          <h2 class="text-xl font-semibold text-gray-900 mb-2">{t.common.noResults}</h2>
          <p class="text-gray-600 mb-6">
            Try adjusting your search filters or explore our featured properties.
          </p>
          <a href="/en/buy" class="btn-primary">
            View All Properties
          </a>
        </div>
      )}

      {filteredProperties.length > 12 && (
        <div class="mt-12 flex justify-center">
          <nav class="flex items-center gap-2">
            <button class="px-4 py-2 border rounded-lg text-gray-600 hover:bg-gray-50">
              {t.common.previous}
            </button>
            <button class="px-4 py-2 bg-primary-600 text-white rounded-lg">1</button>
            <button class="px-4 py-2 border rounded-lg text-gray-600 hover:bg-gray-50">2</button>
            <button class="px-4 py-2 border rounded-lg text-gray-600 hover:bg-gray-50">3</button>
            <button class="px-4 py-2 border rounded-lg text-gray-600 hover:bg-gray-50">
              {t.common.next}
            </button>
          </nav>
        </div>
      )}
    </div>
  </section>
</Layout>
