---
import Layout from '../../layouts/Layout.astro';
import Pagination from '../../components/Pagination.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import { useTranslations } from '../../i18n';
import { getLocationsWithStats } from '../../lib/meilisearch';

// SSR para datos dinámicos
export const prerender = false;

const t = useTranslations('es');

// Obtener todas las ubicaciones con conteos
let locations: Array<{ slug: string; name: string; province: string; propertyCount: number; sampleImage: string | null }> = [];
try {
  locations = await getLocationsWithStats();
} catch (error) {
  console.error('Error fetching locations:', error);
}

// Imagen placeholder
const defaultImage = 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800';

const pageTitle = 'Propiedades por Ubicación | Ubíkala.com';
const pageDescription = 'Explora propiedades en venta y alquiler en las principales ciudades y zonas de República Dominicana. Punta Cana, Santo Domingo, Santiago y más.';
---

<Layout
  title={pageTitle}
  description={pageDescription}
  keywords="propiedades republica dominicana, inmuebles por ubicacion, casas santo domingo, apartamentos punta cana, propiedades santiago"
>
  <Breadcrumb items={[
    { label: 'Inicio', href: '/' },
    { label: 'Propiedades' }
  ]} />

  <!-- Hero -->
  <section class="bg-gradient-to-r from-primary-600 to-primary-700 py-12">
    <div class="container-custom">
      <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">
        Propiedades por Ubicación
      </h1>
      <p class="text-primary-100 text-lg max-w-3xl">
        Explora las principales ciudades y zonas de República Dominicana donde tenemos propiedades disponibles para ti.
      </p>
    </div>
  </section>

  <!-- Locations Grid -->
  <section class="section">
    <div class="container-custom">
      <div class="flex items-center justify-between mb-8">
        <p class="text-gray-600">
          <span class="font-semibold text-gray-900">{locations.length}</span> ubicaciones disponibles
        </p>
      </div>

      {locations.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {locations.map((location) => (
            <a
              href={`/propiedades/${location.slug}`}
              class="group relative overflow-hidden rounded-2xl h-[250px]"
            >
              <img
                src={location.sampleImage || defaultImage}
                alt={`Propiedades en ${location.name}`}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>
              <div class="absolute bottom-0 left-0 right-0 p-6">
                <h3 class="text-white font-bold text-xl mb-1">
                  {location.name}
                </h3>
                <p class="text-gray-200 text-sm mb-3">
                  {location.province}
                </p>
                <span class="inline-flex items-center gap-2 text-white text-sm bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                  </svg>
                  {location.propertyCount} {location.propertyCount === 1 ? 'propiedad' : 'propiedades'}
                </span>
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="card p-12 text-center">
          <p class="text-gray-600">No hay ubicaciones disponibles.</p>
        </div>
      )}
    </div>
  </section>

  <!-- SEO Content -->
  <section class="py-12 bg-gray-50">
    <div class="container-custom">
      <div class="prose prose-lg max-w-4xl mx-auto">
        <h2>Encuentra Propiedades en Todo el País</h2>
        <p>
          República Dominicana ofrece una amplia variedad de ubicaciones para invertir en bienes raíces.
          Desde las playas paradisíacas de Punta Cana hasta la vibrante capital Santo Domingo,
          cada zona tiene características únicas que se adaptan a diferentes estilos de vida y objetivos de inversión.
        </p>

        <h3>Destinos Más Populares</h3>
        <ul>
          <li><strong>Punta Cana:</strong> El destino turístico #1 del Caribe con excelente retorno de inversión.</li>
          <li><strong>Santo Domingo:</strong> La capital con opciones para todos los presupuestos.</li>
          <li><strong>Santiago:</strong> La segunda ciudad más grande con precios accesibles.</li>
          <li><strong>Las Terrenas:</strong> Paraíso bohemio con propiedades frente al mar.</li>
          <li><strong>Puerto Plata:</strong> Costa norte con playas espectaculares y golf.</li>
        </ul>
      </div>
    </div>
  </section>
</Layout>
